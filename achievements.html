<!DOCTYPE html>
<html class="light" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0, viewport-fit=cover" name="viewport" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#13daec">
    <title>Achievements - Sudoku Play</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet" />
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#13daec",
                        "background-light": "#f6f8f8",
                        "background-dark": "#102022",
                        "card-light": "#ffffff",
                        "card-dark": "#1c2c2e",
                    },
                    fontFamily: { "display": ["Plus Jakarta Sans", "sans-serif"] },
                },
            },
        }
    </script>
    <style>
        body {
            min-height: 100dvh;
            touch-action: manipulation;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }
        .achievement-card.locked {
            opacity: 0.5;
            filter: grayscale(1);
        }
        .achievement-card.unlocked {
            animation: unlock 0.5s ease-out;
        }
        @keyframes unlock {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-text-light dark:text-text-dark">
    <div class="relative flex h-auto min-h-screen w-full flex-col overflow-x-hidden">
        <!-- Header -->
        <div class="flex items-center p-4 pb-2 justify-between sticky top-0 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-sm z-10">
            <button onclick="window.location.href='index.html'" class="flex size-12 shrink-0 items-center justify-start transition-transform active:scale-90">
                <span class="material-symbols-outlined text-3xl">arrow_back_ios_new</span>
            </button>
            <h1 class="text-xl font-bold flex-1 text-center" data-i18n="achievements">Achievements</h1>
            <div class="size-12 shrink-0"></div>
        </div>

        <main class="flex-grow p-4 space-y-4 overflow-y-auto">
            <!-- Progress -->
            <div class="bg-card-light dark:bg-card-dark rounded-xl p-4 shadow-sm">
                <div class="flex items-center justify-between mb-2">
                    <span class="font-medium" data-i18n="progress">Progress</span>
                    <span class="text-primary font-bold" id="progress-text">0 / 15</span>
                </div>
                <div class="h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                    <div id="progress-bar" class="h-full bg-gradient-to-r from-primary to-cyan-400 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>

            <!-- Achievements List -->
            <div id="achievements-list" class="space-y-3">
                <!-- Generated by JS -->
            </div>
        </main>
    </div>

    <script src="translations.js"></script>
    <script>
        // Dark mode
        if (localStorage.getItem('darkMode') === 'true') {
            document.documentElement.classList.add('dark');
        }

        // Achievements definitions with translation keys
        const ACHIEVEMENTS = [
            // Getting Started
            { id: 'first_win', icon: 'ðŸŽ¯', nameKey: 'achFirstWin', desc: 'Complete your first puzzle', check: s => s.gamesWon >= 1 },
            { id: 'ten_wins', icon: 'ðŸ”Ÿ', nameKey: 'achTenWins', desc: 'Complete 10 puzzles', check: s => s.gamesWon >= 10 },
            { id: 'fifty_wins', icon: 'ðŸ…', nameKey: 'achFiftyWins', desc: 'Complete 50 puzzles', check: s => s.gamesWon >= 50 },
            { id: 'hundred_wins', icon: 'ðŸ’¯', nameKey: 'achHundredWins', desc: 'Complete 100 puzzles', check: s => s.gamesWon >= 100 },

            // Difficulty
            { id: 'easy_master', icon: 'ðŸŒ±', nameKey: 'achEasyMaster', desc: 'Complete 10 Easy puzzles', check: s => (s.byDifficulty?.easy?.won || 0) >= 10 },
            { id: 'medium_master', icon: 'ðŸŒ¿', nameKey: 'achMediumMaster', desc: 'Complete 10 Medium puzzles', check: s => (s.byDifficulty?.medium?.won || 0) >= 10 },
            { id: 'hard_master', icon: 'ðŸ”¥', nameKey: 'achHardMaster', desc: 'Complete 10 Hard puzzles', check: s => (s.byDifficulty?.hard?.won || 0) >= 10 },
            { id: 'expert_master', icon: 'ðŸ’€', nameKey: 'achExpertMaster', desc: 'Complete 10 Expert puzzles', check: s => (s.byDifficulty?.expert?.won || 0) >= 10 },

            // Streaks
            { id: 'streak_3', icon: 'ðŸ”¥', nameKey: 'achStreak3', desc: 'Achieve a 3-day streak', check: s => s.streakBest >= 3 },
            { id: 'streak_7', icon: 'ðŸ”¥', nameKey: 'achStreak7', desc: 'Achieve a 7-day streak', check: s => s.streakBest >= 7 },
            { id: 'streak_30', icon: 'ðŸ”¥', nameKey: 'achStreak30', desc: 'Achieve a 30-day streak', check: s => s.streakBest >= 30 },

            // Perfection
            { id: 'no_mistakes', icon: 'âœ¨', nameKey: 'achPerfect', desc: 'Complete a puzzle with no mistakes', check: s => s.gamesWon > 0 },
            { id: 'no_hints', icon: 'ðŸ§ ', nameKey: 'achNoHints', desc: 'Complete a puzzle without hints', check: s => s.gamesWon > 0 },

            // XP & Levels
            { id: 'level_5', icon: 'â­', nameKey: 'achLevel5', desc: 'Reach Level 5', check: s => (s.level || 1) >= 5 },
            { id: 'level_10', icon: 'ðŸŒŸ', nameKey: 'achLevel10', desc: 'Reach Level 10', check: s => (s.level || 1) >= 10 },

            // Time Attack
            { id: 'speed_demon', icon: 'âš¡', nameKey: 'achTimeAttack', desc: 'Complete a Time Attack game', check: s => s.gamesWon >= 1 },
        ];

        function loadAchievements() {
            const stats = JSON.parse(localStorage.getItem('sudoku_stats') || '{}');
            const unlocked = JSON.parse(localStorage.getItem('sudoku_achievements') || '[]');
            const list = document.getElementById('achievements-list');
            list.innerHTML = '';

            let unlockedCount = 0;

            ACHIEVEMENTS.forEach(ach => {
                const isUnlocked = ach.check(stats);
                if (isUnlocked && !unlocked.includes(ach.id)) {
                    unlocked.push(ach.id);
                    localStorage.setItem('sudoku_achievements', JSON.stringify(unlocked));
                }

                if (isUnlocked) unlockedCount++;

                const card = document.createElement('div');
                card.className = `achievement-card bg-card-light dark:bg-card-dark rounded-xl p-4 shadow-sm flex items-center gap-4 ${isUnlocked ? 'unlocked' : 'locked'}`;
                card.innerHTML = `
                    <div class="text-4xl">${ach.icon}</div>
                    <div class="flex-1">
                        <p class="font-bold">${t(ach.nameKey)}</p>
                        <p class="text-sm text-gray-500">${ach.desc}</p>
                    </div>
                    <div class="text-2xl">${isUnlocked ? 'âœ…' : 'ðŸ”’'}</div>
                `;
                list.appendChild(card);
            });

            // Update progress
            document.getElementById('progress-text').textContent = `${unlockedCount} / ${ACHIEVEMENTS.length}`;
            document.getElementById('progress-bar').style.width = ((unlockedCount / ACHIEVEMENTS.length) * 100) + '%';
        }

        // Apply translations and load
        document.addEventListener('DOMContentLoaded', () => {
            applyTranslations();
            loadAchievements();
        });
    </script>
</body>

</html>
